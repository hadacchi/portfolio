# portfolio simulator

ポートフォリオやリバランスのシミュレーションを行う

## 実装済

- 年率リスク、年率リターン
    - risk-return.py
- リバランス、ノーセルリバランス
    - deal.py
- 過去データの読み込み
    - load_ts.py
- シミュレーション
    - notebook上で個別に実装
    - 時系列を基準日の値が1.0となるように正規化し、基準日以降のみ返したものを、基準日以前を0fillして元の系列に加算
    - 1日ずつリターン計算をしてないので、当初に想定したシミュレータークラスにするのは却って難しいかもしれない
- レポーティング
    - notebook上で個別に実装
    - グラフをpngで出力してpptxのテンプレにページ追加して張り込み

## TODO

- [ ] ~~結論をレポート出力する部分を作って、本PJはクローズとしたい~~
    - レポート部分を必要としないので，既存のnotebookを参照することとして，このままクローズする
- [x] 過去データの入手 → load_ts.py
    - できればdailyのデータが欲しい
    - APIでダウンロードするのは yfinance が一番手軽だが、取れないものも結構ある
    - 国内ETFは投信協会のライブラリから手でダウンロードが一番取り易い
    - どちらを使っても指数の過去データを指数設定日まで遡ることはできない
- [x] フレームワークの選択
    - 開発はjupyter上で行う
    - シミュレーション用のクラスは作ってメソッドを呼ぶだけでシミュレーションを出したい

## 要件 (作成中)

- ~~PS = new PortfolioSims(attr) でシミュレータを構築~~
    - 投信の時系列を投資時点の値で正規化して加算した方が早いし誤差の蓄積がないので，シミュレータ型での実装は中止
- 指定するパラメタは
    - 期間: 開始日，~~終了日~~
        - 終了日の設定は不要
    - リバランス条件
        - 定期リバランスの場合は，リバランス日
        - 乖離率リバランスの場合は，乖離率
    - 積立金額
    - 積立日
    - 銘柄
    - 税率 20.315%
- 考慮すること
    - ~~営業日は日本国内基準~~
        - そもそもデータがないとシミュレートできないのだから，仕様で指定できない
    - ~~土日は翌営業日に取引成立~~
        - 月またぎが複雑なわりに影響が小さいので無視
    - ~~約定は注文の翌営業日の終値~~
        - 月またぎが複雑なわりに影響が小さいので無視
- 考慮しないこと
    - ~~一旦，ドル建て資産のドル貨決済は考えない~~
        - あるデータをそのまま使う
    - 外国税と外国税額控除は考えない~~，つまり国内で買える円建て投信のみ~~
        - 外国税調整の証券会社が多いので，無視する
    - 投信ごとの約定までの期間

## 必要な機能

- [x] Yahoo! ファイナンスから過去の時系列データを取得する機能
    - 銘柄のIDを指定してデータを入手する
    - ~~pandas-datareader~~, yfinance
    - ~~quandl~~ は使えなくなった
- [x] 投資信託協会のデータを使った操作